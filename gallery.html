<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sportwave News</title>
    
    <!-- Prevent Caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Disable local storage, cookies, and cache in modern browsers -->
    <script>
        // Disable localStorage and sessionStorage
        Object.defineProperty(window, 'localStorage', { value: null });
        Object.defineProperty(window, 'sessionStorage', { value: null });

        // Clear cache and prevent service workers from caching
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister();
                }
            });
        }

        // Clear cookies
        document.cookie.split(";").forEach((c) => {
            document.cookie = c
                .replace(/^ +/, "")
                .replace(/=.*/, `=;expires=${new Date().toUTCString()};path=/`);
        });
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            margin: 0;
            padding: 0;
            background: #121212;
            color: #fff;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 1rem;
        }

        h1 {
            text-align: center;
            font-size: 3rem;
        }

        #search {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
        }

        .news-item {
            background: #1e1e1e;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .news-item h2 {
            font-size: 1.8rem;
        }

        .news-item a {
            color: #00bcd4;
            text-decoration: none;
        }

        .news-item a:hover {
            text-decoration: underline;
        }

        .carousel {
            display: flex;
            overflow: hidden;
            position: relative;
            width: 100%;
        }

        .carousel img {
            width: 100%;
            display: none;
        }

        .carousel img.active {
            display: block;
        }

        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }

        .prev {
            left: 10px;
        }

        .next {
            right: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Sportwave News</h1>
        <input type="text" id="search" placeholder="Search News by Title...">
        <div id="news-container"></div>
    </div>

    <script>
        const rssFeedUrl = 'https://sportwaveannouncements.blogspot.com/feeds/posts/default';

        async function fetchRSS() {
            try {
                // Ensure the request is fresh by appending a cache-busting query
                const noCacheUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssFeedUrl)}&nocache=${new Date().getTime()}`;
                const response = await fetch(noCacheUrl, {
                    cache: 'no-store',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                const data = await response.json();
                displayNews(data.items);
            } catch (error) {
                console.error('Error fetching RSS feed:', error);
            }
        }

        function extractImagesFromDescription(description) {
            const imageUrls = [];
            const imgTags = description.match(/<img[^>]+src="([^"]+)"[^>]*>/g) || [];

            imgTags.forEach(imgTag => {
                const urlMatch = imgTag.match(/src="([^"]+)"/);
                if (urlMatch) {
                    let imageUrl = urlMatch[1];
                    imageUrl = imageUrl.replace(/\/s\d+\//, '/s1920/');
                    imageUrls.push(imageUrl);
                }
            });

            return imageUrls;
        }

        function createImageCarousel(images) {
            if (images.length <= 1) return '';

            return `
                <div class="carousel">
                    ${images.map((img, index) => `<img src="${img}" class="${index === 0 ? 'active' : ''}" alt="news image">`).join('')}
                    <button class="carousel-btn prev" onclick="prevSlide(this)">❮</button>
                    <button class="carousel-btn next" onclick="nextSlide(this)">❯</button>
                </div>
            `;
        }

        function displayNews(items) {
            const container = document.getElementById('news-container');
            container.innerHTML = '';

            items.forEach(item => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';

                const images = extractImagesFromDescription(item.description);
                const carousel = createImageCarousel(images);

                newsItem.innerHTML = `
                    <h2>${item.title}</h2>
                    ${carousel}
                    <a href="${item.link}" target="_blank">Read More</a>
                `;

                container.appendChild(newsItem);
            });
        }

        function prevSlide(button) {
            const carousel = button.parentElement;
            const images = carousel.querySelectorAll('img');
            let activeIndex = Array.from(images).findIndex(img => img.classList.contains('active'));

            images[activeIndex].classList.remove('active');
            activeIndex = (activeIndex - 1 + images.length) % images.length;
            images[activeIndex].classList.add('active');
        }

        function nextSlide(button) {
            const carousel = button.parentElement;
            const images = carousel.querySelectorAll('img');
            let activeIndex = Array.from(images).findIndex(img => img.classList.contains('active'));

            images[activeIndex].classList.remove('active');
            activeIndex = (activeIndex + 1) % images.length;
            images[activeIndex].classList.add('active');
        }

        // Refresh every 30 seconds without cache
        setInterval(fetchRSS, 30000);

        fetchRSS();
    </script>
</body>

</html>
